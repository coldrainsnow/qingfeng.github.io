---
layout: post
title: C++开发经验

---

{{ page.title }}
================

<p class="meta">09 May 2022 - Guangzhou</p>

```
<table><tr><td bgcolor=#FEF6F8> 这篇博客是记录自己从新人小白慢慢成长的过程，内容都是工作中实际遇到的问题。之前是写在有道云笔记上，但随着保存的内容越来越多，自己没怎么回顾，所以干脆写出来加深下记忆 </td></tr></table>
```





# #if #else #endif



其实也按照if else来理解，大概意思是一样的

但是#if #else #endif 他们是在预处理阶段 ，所以判断为真的那部分代码才进行编译

ex:

```c++
#if CAD_VERSION >= 2018
	代码A部分
#else
    代码B部分
#endif
```

仅当预处理阶段判断CAD_VERSION >= 2018时，才采用代码A，否则采用代码B

另外它的使用场景也可以是判断是否为Linux还是Window平台

假如现在要开发一个C语言程序，让它输出红色的文字，并且要求跨平台，在 Windows 和 Linux 下都能运行，怎么办呢？

这个程序的难点在于，不同平台下控制文字颜色的代码不一样，我们必须要能够识别出不同的平台。

Windows 有专有的宏`_WIN32`，Linux 有专有的宏`__linux__`，以现有的知识，我们很容易就想到了 [if else](http://c.biancheng.net/c/if_else/)，请看下面的代码：

```c++
#include <stdio.h>
int main(){
    if(_WIN32){
        system("color 0c");
        printf("http://c.biancheng.net\n");
    }else if(__linux__){
        printf("\033[22;31mhttp://c.biancheng.net\n\033[22;30m");
    }else{
        printf("http://c.biancheng.net\n");
    }
    return 0;
}
```

但这段代码是错误的，在 Windows 下提示 __linux__ 是未定义的标识符，在 Linux 下提示 _Win32 是未定义的标识符。对上面的代码进行改进：

```c++
#include <stdio.h>
int main(){
    #if _WIN32
        system("color 0c");
        printf("http://c.biancheng.net\n");
    #elif __linux__
        printf("\033[22;31mhttp://c.biancheng.net\n\033[22;30m");
    #else
        printf("http://c.biancheng.net\n");
    #endif
    return 0;
}
```

由于在window和linux平台下有时使用的头文件或者处理方法都不太一样，所以会用到它

这些操作都是在预处理阶段完成的，多余的代码以及所有的宏都不会参与编译，不仅保证了代码的正确性，还减小了编译后文件的体积

这种能够根据不同情况编译不同代码、产生不同目标文件的机制，称为条件编译。条件编译是预处理程序的功能，不是编译器的功能

